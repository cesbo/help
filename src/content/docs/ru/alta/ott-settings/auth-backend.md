---
title: "Auth: HTTP Backend"
sidebar:
    order: 5
---

Система Backend Authorization предназначена для проверки клиентских запросов при помощи внешней HTTP-сервиса расширяемым способом.

![Backend Authorization](https://cdn.cesbo.com/help/alta/ott-settings/authorization/http-backend/options.png)

URL бекенда зависит от используемого промежуточного ПО. Когда клиент начинает канал, Alta отправляет запрос в сервис бекенда. Сервис бекенда проверяет клиентский запрос на основании своих собственных правил и возвращает ответ в Alta. Статус ответа 200 означает, что доступ к контенту разрешен, в то время как любой другой ответ означает отказ в доступе. Если сервис бекенда недоступен, некий служит модель поведения по умолчанию.

## Ministra / Stalker

URL бекенда:

```
http://example.com/stalker_portal/server/api/chk_flussonic_tmp_link.php
```

В настройках Ministra / Stalker включите опцию "Временный URL - поддержка Flussonic".

## IPTVPORTAL

URL бекенда:

```
https://go.iptvportal.cloud/auth/arescrypt/
```

В настройках портала откройте меню "Keys" и создайте новый ключ:

- Имя: Alta
- Алгоритм: ARESSTREAM
- Режим: SM
- Длина ключа: 1472 бит
- Частота обновления: 1:00:00

В настройках канала:

- Аутентификация: arescrypt
- Закодировано: включено
- Ключ: Alta

## Microimpulse Smarty

URL бекенда:

```
http://example.com/tvmiddleware/api/streamservice/token/check/
```

## Пользовательский бекенд

Если вам необходимо реализовать собственную логику аутентификации, вы можете создать свой собственный бекенд.

Alta отправляет HTTP GET запрос на бекенд, добавляя все параметры URL из оригинального запроса к URL бекенда. В дополнение к параметрам URL, Alta также отправляет следующие HTTP заголовки на бекенд:

- `X-Session-Id` - уникальный идентификатор сессии
- `X-Real-Ip` - IP адрес клиента
- `X-Real-Path` - путь, запрашиваемый клиентом
- `X-Real-Origin` - источник, состоящий из комбинации протокола (например http или https), имени хоста и порта (если указан)
- `X-Real-Ua` - User-Agent из оригинального запроса

В этом руководстве мы предоставляем пример чрезвычайно простого PHP бекенда, который позволяет доступ, если токен равен `123`.

Создайте новый файл `auth.php` с следующим кодом:

```php
<?php

// Получаем токен из строки запроса
$token = $_GET['token'];

// Проверяем токен
if ($token == '123') {
    // Выводим заголовки в консоль и разрешаем доступ
    error_log(
        "\n" .
        " Session ID: " . $_SERVER['HTTP_X_SESSION_ID']  . "\n" .
        "    Real IP: " . $_SERVER['HTTP_X_REAL_IP']     . "\n" .
        "  Real Path: " . $_SERVER['HTTP_X_REAL_PATH']   . "\n" .
        "Real Origin: " . $_SERVER['HTTP_X_REAL_ORIGIN'] . "\n" .
        "    Real UA: " . $_SERVER['HTTP_X_REAL_UA']
    );
    http_response_code(200);
} else {
    // Отказываем в доступе
    http_response_code(403);
}
```

Чтобы запустить бекенд на сервере с Alta, выполните следующую команду:

```sh
php -S 127.0.0.1:6000 auth.php
```

URL бекенда будет:

```
http://127.0.0.1:6000
```

Для производственных сред вы можете использовать nginx с php-fpm или любое другое подходящее решение.

:::caution
Обратите внимание, что это всего лишь пример, и вам следует реализовать собственную логику бекенда в соответствии с вашими конкретными требованиями.
:::

## Устранение неполадок

### Неожиданный доступ

Если вы получили доступ к каналу без авторизации, вероятно, ваш HTTP бекенд недоступен. Вы можете проверить это командой `curl`. Откройте консоль на сервере с Astra и попробуйте отправить запрос на HTTP бекенд вручную:

```sh
curl -v "http://127.0.0.1:6000?token=123"
```

Конечно, адрес должен быть таким же, как в ваших настройках.

Если вы видите что-то вроде **Connection refused** или соединение зависает без какого-либо ответа, значит, проблемы с доступом к бекенду.