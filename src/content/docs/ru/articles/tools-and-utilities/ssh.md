---
title: "SSH: Basics"
sidebar:
    order: 11
---

SSH - основной протокол и инструмент для управления удалёнными серверами. Также позволяет создавать туннели и передавать файлы.

## Утилиты SSH

### OpenSSH Server

- `sshd` (OpenSSH Daemon): серверный демон, который слушает входящие SSH-подключения. Аутентифицирует пользователей и устанавливает защищённые сессии.
- `sftp-server` (подсистема SFTP сервера): программа для передачи файлов с использованием протокола SFTP, обычно автоматическая вызываемая демоном sshd.

### OpenSSH Client

- `ssh` (SSH клиент): вход на удалённый сервер, предоставляет виртуальный терминал и выполняет команды.
- `ssh-keygen`: создаёт и управляет ключами аутентификации.
- `scp`: копирует файлы между локальной и удалённой машинами, используя зашифрованный канал.
- `sftp`: передаёт файлы по защищённому каналу, аналогично FTP.

## Подключение к серверу

```bash
ssh root@example.com
```

Подключение к серверу с указанием нестандартного порта:

```bash
ssh -p 2222 root@example.com
```

Подключение к серверу с использованием конкретного приватного ключа:

```
ssh -i ~/.ssh/server_ed25519 root@example.com
```

## Конфигурация клиента

SSH клиент может работать без конфигурационного файла и получать все необходимые параметры из аргументов командной строки. Тем не менее, можно создать конфигурационный файл с именем `~/.ssh/config`. Этот файл должен содержать следующую информацию:

```
Host example.com
    HostName 192.168.1.1
    User root
    Port 2222
    IdentityFile ~/.ssh/server_ed25519
```

- `Host`: имя сервера. Это имя используется в команде подключения: `ssh example.com`
- `HostName`: необязательный адрес сервера. Если HostName не определён, следует указать правильный адрес или имя хоста в `Host`
- `User`: имя пользователя
- `Port`: порт сервера. По умолчанию: `22`
- `IdentityFile`: необязательное поле, которое указывает полный путь к файлу приватного ключа

## SSH ключи

SSH ключи предоставляют более безопасный способ входа на SSH сервер по сравнению с использованием паролей. Они состоят из пары ключей: публичного и приватного. Публичный ключ размещается на сервере, к которому вы хотите подключиться, в то время как приватный ключ остаётся на вашей локальной машине.

:::caution
Не делитесь своими приватными ключами!
:::

### Генерация

Чтобы сгенерировать пару SSH ключей, используйте следующую команду:

```bash
ssh-keygen -t ed25519 -f ~/.ssh/server_ed25519
```

- `ed25519` - выбирает тип шифрования. Ed25519 - оптимальный выбор
- `~/.ssh/server_ed25519` - путь к файлу приватного ключа. Публичный ключ будет сгенерирован как `~/.ssh/server_ed25519.pub`

После запуска команды система запросит вас ввести пароль. Этот пароль обеспечивает дополнительный уровень безопасности и должен быть введён при подключении к серверу.

Публичный ключ - это одна строка в следующем формате:

```
ssh-ed25519 AAAA...UUUU user@example.com
```

### Копирование публичного ключа на сервер

На стороне сервера добавьте эту строку в файл `~/.ssh/authorized_keys`. Этот файл может содержать один или несколько ключей. Для добавления публичного ключа выполните следующую команду:

```bash
echo "ssh-ed25519 AAAA...UUUU user@example.com" >>~/.ssh/authorized_keys
```

## Переадресация SSH-агента

Переадресация SSH-агента позволяет использовать ваши локальные SSH-ключи на удалённом сервере без их передачи. Это полезно, когда вам нужно получить доступ к другому серверу с первого сервера, не сохраняя ключи на удалённом сервере.

Вы можете включить переадресацию SSH-агента, используя опцию -A с командой ssh:

```bash
ssh -A example.com
```

Кроме того, вы можете включить её постоянно для конкретного хоста в вашем SSH конфигурационном файле `~/.ssh/config`:

```
Host example.com
    ForwardAgent yes
```

:::note
SSH-агент будет переадресован только в активной SSH-сессии, и приватный ключ не будет скопирован на удалённый сервер. Переадресация SSH-агента не рекомендуется для ненадёжных серверов.
:::

## SSH Proxy Jump

ProxyJump - это ещё один полезный механизм. Он позволяет подключаться к удалённому серверу через промежуточный SSH-сервер, также известный как "прыжковый сервер".

Для подключения к server2 через server1:

```bash
ssh -J user@server1 server2
```

Кроме того, вы можете включить эту возможность постоянно для конкретного хоста в вашем SSH конфигурационном файле `~/.ssh/config`:

```
Host server2
    ProxyJump user@server1
```

Теперь вы можете просто использовать:

```bash
ssh server2
```