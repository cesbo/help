---
title: Variables
description: Type variables in profiles
sidebar:
    order: 2
---

## Переменные

В senta-streamer существует несколько типов переменных, которые вы можете использовать в профилях:

- Стандартные переменные: `${i}` - входной поток, `${o}` - выходной поток
- Пользовательские переменные (текстовые, логические и выборочные)

## Спецификация пользовательских переменных

После ключевого слова WHERE в профиле начинается JSON массив с описанием переменных.

Для каждой переменной создаётся объект со следующими полями:

- `desc` - описание переменной, которую мы используем в команде
- `name` - имя, которое будет использоваться в форме добавления потока
- `description` - описание переменной, которое будет использоваться в форме добавления потока (опционально)
- `command` - часть команды, где `$value` будет заменено на значение из формы добавления потока (например `-gpu $value`).
- `default` - значение по умолчанию, может быть пустым,

Например:

```bash
// Простая стартовая конфигурация для кодирования HD h264
// Вы можете изменить её, форкнуть и поделиться с другими
ffmpeg -y -hide_banner -i ${i} -map 0:0 -map 0:1 -c:v h264_nvenc ${gpu} -preset fast -profile:v main -filter:v yadif -forced-idr 1 -b:v 4M -c:a aac -b:a 128k -r 25 -g 8 -keyint_min 13 -f mpegts ${o}
NAME "HD h264"
WHERE
[
 {
   "desc": "gpu",
   "data": {
    "name": "GPU",
    "description": "Выберите GPU, который будет использовать поток, оставьте пустым, если не используете GPU",
    "command": "-gpu $value",
    "default": ""
   }
 }
]
```

В этом примере:

Стандартные переменные:

Стандартные переменные (о них не нужно писать информацию):
`${i}` - входной поток, можно использовать более одного входа, в меню добавления потока они будут пронумерованы с 0 (вход #0, вход #1 и т.д.)
`${o}` - выходной поток, можно использовать более одного выхода, в меню добавления потока они будут пронумерованы с 0

Пользовательские переменные:

(в этом примере, вы можете добавить то, что вам нужно):
`${gpu}` - номер GPU адаптера

**Примечание:** значение по умолчанию в этом примере пустое (в команде НЕ добавляется `-gpu`), но вы можете установить значение по умолчанию.

## Текстовые переменные

При формировании командной строки текстовые переменные заменяются пользовательским текстом.

Пример текстовой переменной:

```json
{
"desc": "logo",
"data": {
 "name": "Путь к логотипу",
 "description": "Укажите путь к файлу изображения с логотипом",
 "command": "-i $value",
 "default": ""
}
}
```

В профиле переменная `${logo}` будет заменена на `-i $value`.

В редакторе потока будет добавлено поле с меткой `Путь к логотипу`, с описанием `Укажите путь к файлу изображения с логотипом`, и его значение заменит `$value`.

В итоге у нас получается профиль:

```bash
ffmpeg -i ${i} ${logo} bla-bla ${o}
NAME "TEST"
WHERE
[
    {
        "desc": "logo",
        "data": {
             "name": "Путь к логотипу",
             "description": "Укажите путь к файлу изображения с логотипом",
             "command": "-i $value",
             "default": ""
        }
    }
]
```

В настройках потока мы указываем:

```
input#0: 'inp.ts'
output#0: 'udp://out:1234'
logo: 'logo.ts'
```

В результате команда запуска будет:

```bash
ffmpeg -i inp.ts -i logo.ts bla-bla udp://out:1234
```

## Логические переменные

Логические переменные вставляют текст при формировании команды запуска, если значение `true`, и не вставляют его, если значение `false`.

Чтобы задать этот тип, нужно добавить `"extendtion": {"type": "checkbox",}` в структуру переменной.

Пример:

```
// Пример логической переменной
// Эта переменная используется для установки опции -y, которая необходима для перезаписи выходного файла.
"desc": "rev",
"data": {
 "name": "Перезаписать файл",
 "description": "Эта опция нужна, если в качестве выхода используется локальный файл",
 "command": "-y",
 "default": "",
 "extendtion": {
  "type": "checkbox",
 }
}
```

Эта переменная добавляет флаг `-y`, если флажок установлен.

## Выборочные переменные

Аналогично текстовым переменным, только пользователю предоставляется возможность выбора из предустановленных значений. Удобно использовать, например, при установке разрешения изображения или кодека.

Необходимо добавить `"extendtion": {"type": "select"}` в структуру переменной и добавить предустановленные опции в `"options": [...]`.

Пример.

```
// Пример переменной выбора
// Эта переменная используется для выбора видеокодека
"desc": "cv",
"data": {
 "name": "Видеокодек",
 "description": "Чтобы скопировать оригинальный кодек, установите copy",
 "command": "-c:v $value",
 "default": "",
 "extendtion": {
  "type": "select",
  "options": [
   "h264_nvenc",
   "libx264",
   "libx265",
   "hevc_nvenc",
   "libaom-av1",
   "libvpx",
   "libvpx-vp9",
   "copy"
  ]
 }
}
```

## Автогенерация переменной

:::note[Важно!]
Эта функциональность доступна только с активной [лицензией](/en/senta/getting-started/add-license).
:::

Эта функциональность разрабатывается для интеграции с другими системами, такими как [Astra Cesbo](https://cesbo.com). Но вы можете использовать её вручную. На данный момент реализована автоматическая генерация входа.

Например, внешняя система может отправлять потоки с адресами `udp://192.168.0.1:9000` - `udp://192.168.0.1:9999` в Senta для последующего транскодирования. Однако, чтобы создать процесс, нам нужно знать доступный порт (так как порт может быть уже занят другим потоком). Чтобы позволить Senta выделить порт, нужно:

Перейти в Настройки, где есть раздел настроек автоматической генерации входов. Там установить начальный порт: `9000`, конечный порт: `9999`, и IP интерфейса: `192.168.0.1`. Затем применить настройки.

![Пример входа](https://cesbo.b-cdn.net/senta/help/auto-gen.png)

При создании процесса мы назначаем входной адрес как `udp://${host}:${port}` (или назначаем адрес при создании потока, нажав кнопку `Установить автогенерацию`). Соответственно, создаётся процесс с входом `udp://192.168.0.1:9000`, при условии, что порт 9000 свободен на сервере.

Senta отслеживает свободные/занятые порты. При удалении потока порт, который он занимал, освобождается.