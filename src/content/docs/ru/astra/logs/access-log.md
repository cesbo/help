---
title: HTTP Access Log
sidebar:
    order: 3
---

Журналы доступа HTTP содержат информацию о обработанных запросах встроенным HTTP сервером Astra.

## Конфигурация

По умолчанию журналы доступа HTTP отключены, их можно включить в разделе Настройки → Общие, установив полный путь к файлу журнала в поле "HTTP Access Log". Например: `/var/log/astra-access.log`

## Поля журнала

```
192.168.88.100 - - [11/Aug/2023:07:03:07 +0000] "GET / HTTP/1.1" 200 0
192.168.88.100 - admin [11/Aug/2023:07:03:07 +0000] "POST /control/ HTTP/1.1" 200 0
198.51.100.1 - - [11/Aug/2023:07:03:08 +0000] "GET /play/a0g2/71545838.m3u8 HTTP/1.1" 200 0
198.51.100.1 - - [11/Aug/2023:07:03:08 +0000] "GET /play/a0g2/113900585_92b9.ts HTTP/1.1" 200 0
```

Журнал доступа имеет формат, схожий с большинством HTTP серверов:

```
remote_addr - remote_user [time] "request" status bytes_sent
```

## Ротация журналов

:::caution
Пожалуйста, используйте ротацию журналов для экономии дискового пространства и обеспечения сохранности ваших журналов.
:::

Logrotate — это системная утилита, управляющая автоматической ротацией и сжатием файлов журналов. Чтобы использовать её, создайте новый файл конфигурации по пути `/etc/logrotate.d/astra`:

```
/var/log/astra-access.log {
    daily
    rotate 10
    missingok
    notifempty
    compress
    delaycompress
    sharedscripts
    postrotate
        systemctl reload astra || true
    endscript
}
```

- `/var/log/astra-access.log` - полный путь к файлу журнала. Вы можете указать несколько файлов, разделенных пробелами
- `daily` - ежедневная ротация. Каждый архивный файл журнала будет содержать записи за один день
- `rotate 10` - сохраняются только последние 10 архивных файлов журнала. Для ежедневной ротации это равносильно 10 дням архивов
- `missingok` - игнорировать ошибку, если указанный файл журнала не найден
- `notifempty` - журнал не будет ротирован, если он пустой
- `compress` - сжимать архивные файлы журнала с помощью gzip
- `delaycompress` - новый архивный файл журнала будет сжат на следующий день. Поскольку Astra продолжает записывать логи в новый архивный файл журнала до тех пор, пока не выполнится скрипт `postrotate`, эта опция нужна, чтобы предотвратить потерю последних сообщений
- `sharedscripts` - выполнение скрипта `postrotate` один раз для всех файлов журнала
- `postrotate` - команда выполняется после ротации файла журнала. Astra получает сигнал для начала записи в новый пустой файл