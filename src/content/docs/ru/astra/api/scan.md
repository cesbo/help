---
title: Scan API
---

## Запуск анализатора

Запрос: `POST /control/`

```json
{
    "cmd": "scan-init",
    "scan": "..."
}
```

- `scan` - адрес потока. Подробнее читайте о [формате адреса медиа](/en/astra/streams/address-format/)

Ответ:

```json
{
    "scan-init": "ok",
    "id": "..."
}
```

- `id` - идентификатор созданного экземпляра анализатора

Анализатор будет автоматически остановлен через 10 секунд. Чтобы поддерживать анализатор активным более длительное время, используйте метод API `scan-check`.

## Остановка анализатора

Запрос: `POST /control/`

```json
{
    "cmd": "scan-kill",
    "id": "..."
}
```

- `id` - идентификатор экземпляра анализатора

Этот метод немедленно останавливает анализатор.

## Получение информации

Запрос: `POST /control/`

```json
{
    "cmd": "scan-check",
    "id": "..."
}
```

- `id` - идентификатор экземпляра анализатора

Ответ:

```json
{
    "scan-check": "ok",
    "scan": [
        {
            "psi": "...",
            "table_id": N,
            "pid": N,
            "version": N,
            "crc32": N,
            ...
        }
    ]
}
```

- `scan` - массив с информацией о потоке, если нет новой информации, это поле будет опущено

Информация о потоке:

- `psi` - название пакета Program Stream Information (PSI). Может быть: `pat`, `pmt`, `cat`, `nit`, `sdt`
- `table_id` - идентификатор PSI
- `pid` - идентификатор пакета MPEG-TS
- `version` - версия пакета PSI
- `crc32` - контрольная сумма пакета PSI

Дополнительные поля зависят от типа PSI.

### PAT

Таблица ассоциаций программ (Program Association Table, PAT) — это список программ. Содержит номер программы (PNR) и идентификатор пакета (PID) связанного PMT. Дополнительные поля:

```json
{
    "psi": "pat",
    "table_id": 0,
    "pid": 0,
    "tsid": N,
    "programs": [
        {
            "pnr": N,
            "pid": N
        }
    ]
}
```

- `table_id` - всегда `0`
- `pid` - всегда `0`
- `tsid` - идентификатор транспортного потока
- `programs` - список программ

Информация о программе:

- `pnr` - номер программы
- `pid` - идентификатор пакета MPEG-TS для PMT

### PMT

Таблица сопоставления программ (Program Mapping Table, PMT) — это список элементарных потоков программы: видео, аудио и других данных. Дополнительные поля:

```json
{
    "psi": "pmt",
    "table_id": 2,
    "pnr": N,
    "pid": N,
    "pcr": N,
    "streams": [
        {
            "pid": N,
            "type_name": "...",
            "type_id": N,
            "descriptors": [
                {
                    "type_id": N,
                    "type_name": "...",
                    ...
                }
            ]
        }
    ]
}
```

- `table_id` - всегда `2`
- `pid` - идентификатор пакета MPEG-TS
- `pnr` - номер программы
- `pcr` - идентификатор пакета MPEG-TS для пакетов с временными метками Program Clock Reference (PCR)
- `streams` - список элементарных потоков программы

Информация об элементарном потоке:

- `pid` - идентификатор пакета MPEG-TS для элементарного потока
- `type_name` - тип элементарного потока: `VIDEO`, `AUDIO`, `SUB`, `TTX`, `AIT`, `DATA`
- `type_id` - идентификатор элементарного потока
- `descriptors` - дескрипторы элементарного потока содержат дополнительную информацию