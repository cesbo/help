---
title: Streams API
sidebar:
    order: 2
---

В интерфейсе Astra можно управлять конфигурациями потоков и контролировать их статус, используя методы HTTP API.

:::note
Настраиваемые параметры схожи с используемыми в конфигурации интерфейса Astra, подробнее можно прочитать в соответствующих статьях о настройке этих параметров. Подробнее
:::

## Конфигурация потока

```json
{
    "id": "...",
    "name": "...",
    "type": "...",
    "enable": true,
    "input": [
        ""
    ]
}
```

- `name` - имя потока
- `type` - тип потока `spts` или `mpts`
- `enable` - `true`, если поток включен
- `input` - список входов потока
- другие параметры зависят от конфигурации потока.

## Получение конфигурации потока

Запрос: `GET /api/stream-info/{id}`

- `id` - уникальный идентификатор потока

Ответ будет в формате JSON с конфигурацией потока

## Изменение конфигурации потока

Запрос: `POST /control/`

```json
{
    "id": "...",
    "cmd": "set-stream",
    "stream": { ... }
}
```

- `id` - уникальный идентификатор потока
- `stream` - конфигурация потока

## Переключение потока

Включение/выключение потока. Запрос: `POST /control/`

```json
{
    "cmd": "toggle-stream",
    "id": "..."
}
```

- `id` - уникальный идентификатор потока

:::tip
Вы можете включить или выключить поток, запустив следующую команду:

```sh
curl \
    -X POST \
    -user login \
    -d '{"cmd":"toggle-stream", "id":"a001"}' \
    http://server:8000/control/
```

при успешном выполнении Astra возвращает:

```json
{ "toggle-stream": "ok" }
```
:::

## Перезапуск потока

Запрос: `POST /control/`

```json
{
    "cmd": "restart-stream",
    "id": "..."
}
```

- `id` - уникальный идентификатор потока

## Переключение активного входа

Выбор активного входа. Работает только для потоков с типами резервного копирования: `passive` или `disable`. Запрос: `POST /control/`

```json
{
    "cmd": "set-stream-input",
    "id": "...",
    "input": "..."
}
```

- `id` - уникальный идентификатор потока
- `input` – номер входа. Нумерация начинается с 1. Если параметр не определён, будет выбран следующий вход после текущего активного

:::tip
Вы можете переключить вход потока, запустив следующую команду:

```sh
curl \
    -X POST \
    -user login \
    -d '{"cmd":"set-stream-input", "id":"a001", "input": 2}' \
    http://server:8000/control/
```

при успешном выполнении Astra возвращает:

```json
{ "set-stream-input": "ok" }
```
:::

## Удаление потока

Запрос: `POST /control/`

```json
{
    "cmd": "set-stream",
    "id": "...",
    "stream": {
        "remove": true
    }
}
```

- `id` - уникальный идентификатор потока

## Получение статуса потока

Запрос: `GET /api/stream-status/{id}`

- `id` - уникальный идентификатор потока

Необязательные параметры запроса: `GET /api/stream-status/{id}?t={time}`

- `time` - по умолчанию `1` - статистика за последнюю минуту. `0` - статистика за последнюю секунду (текущий статус потока).

Ответ:

```json
{
    "timestamp": 0,
    "instance": "...",
    "name": "...",
    "input_id": 1,
    "active": true,
    "onair": true,
    "sessions": 0,
    "bitrate": 0,
    "packets": 0,
    "pes_error": 0,
    "sc_error": 0,
    "cc_error": 0,
    "video_count": 1,
    "audio_count": 1
}
```

- `timestamp` - время отчёта, для `t=0` это текущее время
- `instance` - имя экземпляра, если оно определено в Настройки → Общие → Имя экземпляра
- `name` - имя потока
- `input_id` - идентификатор активного входа. например, если основной работает нормально, будет 1. если поток переключен на резервный вход, будет номер этого входа
- `active` - `true` если поток активен, или `false` если поток работает по требованию и неактивен
- `onair` - `true` если активный вход работает без ошибок
- `sessions` - количество активных сессий на потоке
- `bitrate` - битрейт потока в Kbit/s
- `pes_error` - количество невалидных пакетов PES
- `sc_error` - количество зашифрованных пакетов TS. Если поток защищён системой условного доступа (CAS), то `sc_error` и `pes_error` будут больше 0. Если поток расшифрован с недействительным ключом, то `sc_error` будет равен 0, а `pes_error` будет больше 0
- `cc_error` - счётчик ошибок CC. Ошибка CC может быть вызвана потерей пакетов или избытком
- `video_count` - количество видеопотоков
- `audio_count` - количество аудиопотоков