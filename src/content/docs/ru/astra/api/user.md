---
title: Users API
---

Пользователи использовались для управления доступом к Веб-интерфейсу Astra, а также к HTTP MPEG-TS и HLS выходам.

## Конфигурация пользователя

```json
{
    "enable": true,
    "type": 0,
    "comment": "...",

    "token": "...",
    "ip": "...",
    "expire": 0,
    "conlimit": 0
}
```

- `enable` – активирована учетная запись или нет
- `type` – тип пользователя
    - `1` - администратор. полный доступ к Веб-интерфейсу Astra
    - `2` - наблюдатель. доступ к Веб-интерфейсу Astra только для чтения
    - `3` - обычный пользователь. без доступа к Веб-интерфейсу Astra
- `comment` - необязательное поле, для описания пользователя

Необязательные поля для встроенной авторизации для доступа к HLS или HTTP MPEG-TS каналам:

- `token` - токен, используемый в HTTP запросах. Например: `http://server:8000/play/a001/index.m3u8?token=secret`
- `ip` - разрешить доступ к каналам по IP-адресу клиента
- `expire` - дата в виде Unix timestamp, когда доступ к каналам будет ограничен
- `connlimit` - ограничение на количество подключений к каналам

## Получить пользователя

Запрос: `POST /control/`

```json
{
    "cmd": "get-user",
    "id": "..."
}
```

- `id` - логин пользователя

В ответ будет JSON с конфигурацией пользователя

## Создать или обновить пользователя

Запрос: `POST /control/`

```json
{
    "cmd": "set-user",
    "id": "...",
    "user": {
        "enable": true,
        "type": 0,
        "password": "..."
    }
}
```

- `id` – логин пользователя
- `user` - конфигурация пользователя
- `password` - открытый пароль, в конфигурации будет сохранен хэш пароля

<details>
<summary>Пример</summary>

Можно создать нового пользователя, запустив следующую команду:

```sh
curl -X POST -user login -d @- http://server:8000/control/ <<END
{
  "cmd": "set-user",
  "id": "new-admin",
  "user": {
    "enable": true,
    "type": 1,
    "password": "secret"
  }
}
END
```

при успешном выполнении Astra возвращает:

```json
{ "set-user": "ok" }
```
</details>

## Удалить пользователя

Запрос: `POST /control/`

```json
{
    "cmd": "set-user",
    "id": "...",
    "user": {
        "remove": true
    }
}
```

## Включить или отключить пользователя

Запрос: `POST /control/`

Отключить или включить пользователя:

```json
{
    "cmd": "toggle-user",
    "id": "..."
}
```

- `id` - логин пользователя

<details>
<summary>Пример</summary>

Можно включить или отключить пользователя, запустив следующую команду:

```sh
curl \
    -X POST \
    -user login \
    -d '{"cmd":"toggle-user", "id":"login"}' \
    http://server:8000/control/
```

при успешном выполнении Astra возвращает:

```json
{ "toggle-user": "ok" }
```
</details>