---
title: "HLS for Broadcasting"
sidebar:
    order: 12
---

Когда вы отправляете HLS-потоки на вещательные сети, такие как спутниковое, кабельное или наземное телевидение, могут возникнуть проблемы, такие как пикселизация видео, расхождение аудио или щелкающие звуки. На компьютерах эти же потоки могут работать без проблем. Это происходит потому, что HLS и вещательные сети обрабатывают видеоданные по-разному.

## Кодирование видео

Кодирование видео сжимает данные, чтобы уменьшить размер файлов.

### Кадры

Видеопотоки используют различные типы кадров:

- **Ключевой кадр (I-frame)** - содержит полное изображение
- **Последующие кадры (P-кадры и B-кадры)** - хранят только изменения от предыдущего кадра

### GOP (Группа кадров)

GOP — это последовательность, начинающаяся с ключевого кадра, за которым следуют несколько последующих кадров. Например, GOP из 30 означает один ключевой кадр, за которым следуют 29 других кадров. Больший размер GOP означает меньшее количество ключевых кадров, что уменьшает размер файла, но создаёт большие скачки битрейта при появлении ключевых кадров.

## Битрейт потока

Вещательные сети требуют, чтобы видеокадры доставлялись в точное время для поддержания синхронизации аудио и видео. Это требует стабильного, предсказуемого битрейта. Необходимо сбалансировать размер GOP и качество видео, чтобы поддерживать постоянный битрейт для плавного вещания.

![Поток, закодированный для вещания](https://cdn.cesbo.com/help/astra/delivery/broadcasting/limitations-of-hls/broadcast.png)

HLS работает по-другому. Он отправляет видео частями по несколько секунд (обычно 3+ секунды), поэтому лучше справляется с изменениями битрейта. Это позволяет HLS использовать большие размеры GOP и получать лучшее качество видео с более низким средним битрейтом.

![Поток, закодированный для HLS](https://cdn.cesbo.com/help/astra/delivery/broadcasting/limitations-of-hls/ott.png)

Диаграмма показывает, что средний битрейт потоков HLS составляет 2 Мбит/с, но может достигать 6 Мбит/с в пике.

Эта гибкость вызывает проблемы у вещательных сетей, которым требуется стабильная пропускная способность. При использовании HLS-потоков с вещательными системами необходимо скорректировать кодирование в соответствии с требованиями вещания.

## Пиковые битрейты и UDP-вещание

Пики битрейта также вызывают проблемы с UDP-вещанием. У приставок и телевизоров небольшие сетевые буферы. Когда слишком много пакетов прибывает одновременно во время пиков битрейта, буфер переполняется, и пакеты теряются.

## Решение

Astra не имеет встроенных возможностей перекодирования. Вам нужно перекодировать поток, используя внешние инструменты, такие как FFmpeg. Попробуйте следующие настройки:

- **Уменьшите размер GOP**: Используйте около 30 кадров для лучшего качества движения и меньших пиков битрейта
- **Включите чересстрочную развёртку**: Обеспечивает более плавное движение, особенно для вещания
- **Используйте CBR (постоянный битрейт)**: Это заполняет пробелы в битрейте нулевыми пакетами для достижения постоянной скорости