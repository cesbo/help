---
title: Integration Astra with Grafana
date: 2023-06-10
sidebar:
    order: 2
---

Grafana — это веб-приложение с открытым исходным кодом для аналитики и интерактивной визуализации.
Оно работает в паре с [InfluxDB](/en/astra/monitoring/influxdb) для визуализации статуса Astra, потоков и адаптеров.

## Установка

Перед установкой Grafana убедитесь, что InfluxDB установлен и настроен: [Читать далее...](/en/astra/monitoring/influxdb)

Скачайте последнюю версию с

1. Перейдите на сайт Grafana: https://grafana.com/grafana/download
2. Выберите последнюю версию
3. Выберите вашу платформу
4. Запустите команды из инструкции на сайте Grafana

Узнать больше можно на официальном сайте: https://grafana.com/docs/grafana/latest/

## Конфигурация Grafana

1. Откройте интерфейс администратора Grafana: `http://grafana-server:3000`
2. На странице входа введите `admin` в качестве имени пользователя и пароля
3. Установите новый пароль

## Добавление источника данных

Откройте Настройки → Источники данных и нажмите "Добавить источник данных", выберите InfluxDB и установите следующие параметры:

- Имя: `Astra` или любое другое
- Язык запросов: `Flux`
- HTTP URL: `http://db-server:8086`
- Отключите `Basic auth`
- Организация: ваше имя организации в настройках InfluxDB
- Токен: ваш токен, скопированный для настроек Astra
- Минимальный интервал времени: `1m`

Нажмите `Save & Test`, вы должны увидеть зеленое уведомление: `Bucket found`

## Добавление панели инструментов

1. Скачайте наш шаблон для Grafana: [dashboard.json](https://cdn.cesbo.com/astra/grafana/dashboard.json)
2. Откройте: Создать → Импорт
3. Нажмите `Загрузить файл JSON`
4. Выберите загруженный файл
5. Установите любое имя для панели
6. Нажмите `Импорт`

## Панель инструментов

![Панель инструментов Grafana](https://cdn.cesbo.com/help/astra/monitoring/export/grafana/dashboard.png)

Панель инструментов имеет следующие переменные:

- `Source` - выберите `Astra` или другое имя;
- `Bucket` - это имя базы данных в InfluxDB. То же, что и `Имя экземпляра` в настройках Astra.
Если у вас несколько серверов или различных экземпляров Astra на одном сервере, вы можете создать несколько
панелей для каждого экземпляра;
- `Adapter` - Все адаптеры DVB на экземпляре;
- `Stream` - Все потоки на экземпляре.

### Панели статуса

Использование ЦП:
- Использование ЦП системой охватывает все доступные ядра. Максимальное значение — это число ядер, умноженное на 100
- Использование ЦП приложением охватывает все потоки на всех ядрах относительно использования ЦП системой

Использование памяти:

- Использование памяти системой — это общее использование памяти всеми процессами в системе
- Использование памяти приложением — это общее использование памяти всеми потоками приложения. Значение относительно использования памяти системой

Статус:

- `App uptime` - прошедшее время с момента запуска приложения
- `Sys uptime` - прошедшее время с момента запуска системы
- `LA 1m` - средняя нагрузка за 1 минуту
- `LA 5m` - средняя нагрузка за 5 минут
- `LA 15m` - средняя нагрузка за 15 минут

Неудавшиеся потоки - список всех инцидентов, упорядоченных по времени. Недавние события вверху таблицы. Все значения в таблице на момент события:

- `Name` - имя потока
- `Elapsed time` - время, прошедшее с момента возникновения инцидентов
- `Sessions` - количество HTTP/HLS сессий
- `CC Errors` - счётчик обнаруженных событий потери пакетов
- `Sync Errors` - счётчик ошибок синхронизации битрейта HTTP/HLS
- `PES Errors` - процент видео/аудио пакетов с повреждённым содержимым
- `Scrambled` - процент зашифрованных пакетов
- `Bitrate` - битрейт потока в Кбит/с

Адаптеры и потоки:

![Адаптеры и потоки](https://cdn.cesbo.com/help/astra/monitoring/export/grafana/adapters-and-streams.png)

Графики отображаются отдельно для каждого выбранного адаптера или потока.