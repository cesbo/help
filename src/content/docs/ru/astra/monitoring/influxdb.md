---
title: "Integration Astra with InfluxDB"
date: 2023-03-23
sidebar:
    order: 3
---

InfluxDB — это база данных временных рядов с открытым исходным кодом.

## Установка

Скачать последнюю версию можно следующим образом:

1. Перейдите на сайт InfluxDB: https://portal.influxdata.com/downloads/
2. Выберите последнюю версию
3. Выберите вашу платформу
4. Выполните команды из инструкции на сайте InfluxDB

Узнать больше информации можно на официальном сайте: https://docs.influxdata.com/influxdb/latest/

InfluxDB — это база данных временных рядов с открытым исходным кодом.

## Конфигурация InfluxDB

Откройте интерфейс администрирования InfluxDB по адресу `http://db-server:8086`.

Сначала создайте новый бакет. Бакет служит для хранения всех данных, полученных от Astra. Вы можете найти бакеты в левой боковой панели в группе "Load Data". Чтобы создать новый бакет:

1. Нажмите `Create Bucket`
2. Установите имя бакета, например, `astra`
3. Установите срок хранения данных: в разделе `Delete Data`, выберите `Older than` и выберите 30 дней или любое другое значение на ваше усмотрение.

Следующий шаг — предоставить Astra доступ к бакету. В левой боковой панели в группе `Load Data`, откройте `API Tokens`:

1. Нажмите `Generate API Token` и выберите `Custom API Token.`
2. Установите описание токена как `astra`
3. В группе Bucket установите разрешения на чтение и запись для бакета `astra`.
4. Нажмите `Generate`

Теперь InfluxDB настроен и готов принимать данные.

## Конфигурация Astra

Откройте Настройки → Общие в веб-интерфейсе Astra. Установите следующие параметры для конфигурации InfluxDB:

- `Instance Name` - по умолчанию используется `astra` как бакет в InfluxDB
- `InfluxDB Address` - адрес InfluxDB: `http://db-server:8086`
- `InfluxDB Organization` - ваша организация в настройках InfluxDB
- `InfluxDB Token` - вставьте ваш токен, сгенерированный на предыдущем шаге
- Нажмите "Apply & Restart"

## Структура данных InfluxDB

### Поток (Stream)

Измерение: `stream`

Теги:

- `id` - уникальный идентификатор потока
- `name` - название потока

Данные:

- `active` - `true`, если поток активен, или `false`, если поток работает по требованию и неактивен
- `onair` - `true`, если активный вход работает без ошибок
- `sessions` - uint, количество сессий
- `bitrate` - uint, битрейт потока в KBit/с
- `sc_error` - uint, процент поврежденных TS-пакетов
- `cc_error` - uint, счетчик ошибок контроля целостности
- `pes_error` - uint, процент недопустимых PES-пакетов
- `sync_error` - uint, ошибки синхронизации HTTP/HLS

### Адаптер (Adapter)

Измерение: `adapter`

Теги:

- `id` - уникальный идентификатор адаптера
- `name` - название адаптера

Данные:

- `lock` - boolean, `true`, если тюнер заблокирован и может принимать данные
- `signal` - uint, приблизительный уровень сигнала в процентах
- `signal_db` - float, уровень сигнала в dBm
- `snr` - uint, приблизительное отношение сигнал/шум в процентах
- `snr_db` - float, отношение сигнал/шум в dB
- `ber` - uint, счетчик битовых ошибок
- `unc` - uint, счетчик ошибок блоков
- `bitrate` - общий битрейт в Kbit/s

### Системная информация

Измерение: `sysinfo`

Данные:

- `la1` - float, средняя загрузка за 1 минуту
- `la5` - float, средняя загрузка за 5 минут
- `la15` - float, средняя загрузка за 15 минут
- `threads` - uint, количество потоков
- `sys_cpu` - uint, общая загрузка CPU. Может быть до: 100 умножено на количество ядер на всех процессорах
- `app_cpu` - uint, использование CPU процессом и всеми потоками
- `sys_mem` - uint, общее использование RAM
- `app_mem` - uint, использование RAM процессом и всеми потоками
- `app_mem_kb` - uint, использование RAM процессом и всеми потоками в килобайтах
- `sys_uptime` - uint, общее время работы системы в секундах
- `app_uptime` - uint, время работы процесса в секундах